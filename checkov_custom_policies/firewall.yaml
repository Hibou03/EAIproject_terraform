metadata:
  name: "Ensure VM connected to public network has firewall rule"
  id: "CUSTOM_VSPHERE_006"
  category: "NETWORK_SECURITY"
  severity: "HIGH"

definition:
  resource_types: ["vsphere_virtual_machine"]  # Cible uniquement les VMs
  condition:
    and:
      - attribute: "network_interface[0].network_id"  # Vérifie le réseau
        operator: "regex_match"
        value: ".*public.*"  # Adaptez ce pattern à votre nomenclature
      - attribute: "tags"  # Vérifie la présence d'un tag firewall
        operator: "contains"
        value: "firewall_secured"